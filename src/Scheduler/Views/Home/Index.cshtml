@model IndexViewModel

@{
    this.ViewData["Title"] = "Home Page";
    string today = DateTime.Now.ToString("yyyy-MM-dd");
    string startDateString = DateTime.Now.Date.ToString("yyyy-MM-dd");
    string endDateString = DateTime.Now.AddYears(2).ToString("yyyy-MM-dd");
}

<div class="layoutContainer noPrintIfModal text-center" style="padding-left:20px;padding-right:20px;border:2px solid gray;font-size:12px;">
    <h3 class="text-danger">Welcome to the PCYS Scheduling Application</h3>
    <p class="lead">Use the Calendar below to search for Dates and Times of Practices, Games, and other Events at the PCYS facility. You can use the Filtering Menu in the List to refine your search.</p>
    <p class="lead">You can also use the Searchbar Dropdown Menu to search for Events outside of the Calendar. Search by Team Name, Event Name, or a range of Dates.</p>
</div>
<br />
<div id="searchBar">
    <div class="text-center">
        <div class="btn-group mb-2 noPrintIfModal">
            <form action="javascript:void(0);" onsubmit="searchEvents(this)" id="searchForm" autocomplete="off">
                <div>
                    <button type="button" class="btn btn-sm btn-secondary dropdown-toggle" onclick="showHomepageDropdown()" data-bs-toggle="dropdown" data-bs-auto-close="false" aria-expanded="false">Searchbar Dropdown </button>
                    <ul class="dropdown-menu p-3" id="homepage-dropdown">
                        <h5 class="lead text-danger text-center">Search Criteria</h5>
                        <div>
                            <div class="form-label">
                                <label class="form-label">Event Date(s)</label>
                                <input type="text" name="daterange" class="text-center form-control" />
                            </div>
                            <div>
                                <input name="StartDate" type="hidden" id="StartDate" />
                                <br />
                            </div>
                            <div>
                                <input name="EndDate" type="hidden" id="EndDate" />
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Type</label>
                            <select name="type" class="form-select">
                                <option value="Event">Events</option>
                                <option value="Practice">Practices</option>
                                <option value="Game">Games</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Event Name</label>
                            <input type="text" name="searchTerm" class="form-control" />
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Team Name</label>
                            <input type="text" name="teamName" class="form-control" />

                        </div>
                        <div class="text-center">
                            <input type="submit" class="btn btn-sm btn-secondary" value="Search" />
                            <button type="button" class="btn btn-sm btn-danger text-end" onclick="closeHomePageDropdown()">Close</button>
                        </div>
                    </ul>
                    <button class="btn btn-sm btn-danger" type="reset" onclick="resetEvents()">Reset Searchbar</button>
                </div>
            </form>
        </div>
    </div>
</div>
<div id="calendar">
    @await this.Component.InvokeAsync("Calendar")
</div>
@section Scripts {
<script>
    function showHomepageDropdown() {
        $('#homepage-dropdown').addClass('show');
    }

    function closeHomePageDropdown() {
        $('#homepage-dropdown').removeClass('show');
    }

    var startDateString = "@startDateString";
    var endDateString = "@endDateString";
    var minDateString = "@today";
    var startDate;
    var startDateFormatted;
    var endDate;
    var endDateFormatted;
    var minDate;
    var minDateFormatted;
    startDate = moment(startDateString, "YYYY-MM-DD"); // Parse the start date string and specify the format
    startDateFormatted = startDate.format('M/DD/YYYY'); // Format the start date as desired
    endDate = moment(endDateString, "YYYY-MM-DD"); // Parse the end date string and specify the format
    endDateFormatted = endDate.format('M/DD/YYYY'); // Format the end date as desired
    minDate = moment(minDateString, "YYYY-MM-DD"); // Parse the min date string and specify the format
    minDateFormatted = minDate.format('M/DD/YYYY'); // Format the min date as desired
    $('#StartDate').val(startDateFormatted); // Set initial value of StartDate on the form
    $('#EndDate').val(endDateFormatted); // Set initial value of EndDate on the form


    $(function () {
        $('input[name="daterange"]').daterangepicker({
            startDate: startDateFormatted,
            endDate: endDateFormatted,
            minDate: minDateFormatted,
            timePickerIncrement: 30,
            drops: "up",
            locale: {
                format: 'M/DD/YYYY'
            }
        }).on('apply.daterangepicker', function (ev, picker) {
            startDateFormatted = picker.startDate.format('M/DD/YYYY');
            endDateFormatted = picker.endDate.format('M/DD/YYYY');
            $('#StartDate').val(startDateFormatted); // Resets the value of StartDate when "Apply" is pressed
            $('#EndDate').val(endDateFormatted); // Resets the value of EndDate when "Apply" is pressed
        });
    });    

    function searchEvents(e) {
        $.ajax({
            url: '@Url.Action("searchModal", "Dashboard")',
            data: {
                start: e.StartDate.value,
                end: e.EndDate.value,
                type: e.type.value,
                searchTerm: e.searchTerm.value,
                teamName: e.teamName.value
            },
            success: function (data) {
                $('#modal').html(data);
                $('#homepage-dropdown').removeClass('show');
            }
        });
    }

        function resetEvents(e){
        $.ajax({
            url: '@Url.Action("searchModal", "Dashboard")',
            data: {
                start: @startDateString,
                end: @endDateString,
                type: 'Event',
                searchTerm: '',
                teamName: ''
            },
            success: function(data) {
                    $("#modal").html(data);
            }
        });
    }
</script>
}
